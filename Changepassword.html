<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Change Password - University of Sri Jayawardenapura</title>
    <link rel="stylesheet" href="ChangePassword.css">
</head>

<body>
    <div class="main">
    <div class="navbar">
      <div class="icon">
        <h2 class="logo">Learning Management System</h2>
      </div>
      <div class="menu">
        <ul>
          <li><a href="student-profile.html">HOME</a></li>
          <li><a href="#footer">CONTACT US</a></li>
        </ul>
      </div>
    </div>
    <div class="change-password-container">
        <h2>Change Password</h2>
        <form id="changePasswordForm" autocomplete="off">
            <div class="form-group">
                <label for="currentPassword">Current Password</label>
                <input type="password" id="currentPassword" name="currentPassword" required>
            </div>
            <div class="form-group">
                <label for="newPassword">New Password</label>
                <input type="password" id="newPassword" name="newPassword" required>
            </div>
            <div class="form-group">
                <label for="confirmPassword">Confirm New Password</label>
                <input type="password" id="confirmPassword" name="confirmPassword" required>
            </div>
            <button type="submit" class="submit-btn">Change Password</button>
            <div class="message" id="message"></div>
        </form>
    </div>
    <footer id="footer">
    <div class="footer-content">
        <h3>Contact Us</h3>
        <p>University of Sri Jayewardenepura, Gangodawila, Nugegoda</p>
        <p>E-mail : <a href="mailto:info@sjp.ac.lk">info@sjp.ac.lk</a></p>
    </div>
</footer>
    <script>
        document.getElementById('changePasswordForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const message = document.getElementById('message');

            // Client-side validation
            if (newPassword !== confirmPassword) {
                message.style.color = "red";
                message.textContent = "New passwords do not match.";
                return;
            }

            if (newPassword.length < 8) {
                message.style.color = "red";
                message.textContent = "Password must be at least 8 characters long.";
                return;
            }

            // Show loading message
            message.style.color = "white";
            message.textContent = "Changing password...";

            // Create FormData object
            const formData = new FormData();
            formData.append('currentPassword', currentPassword);
            formData.append('newPassword', newPassword);
            formData.append('confirmPassword', confirmPassword);

            // Send AJAX request to PHP
            fetch('ChangePassword.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    message.style.color = "green";
                    message.textContent = data.message;
                    
                    // Clear form fields
                    document.getElementById('changePasswordForm').reset();
                    
                    // Redirect to profile page after 2 seconds
                    setTimeout(() => {
                        window.location.href = 'login.html'; 
                    }, 1000);
                } else {
                    message.style.color = "red";
                    message.textContent = data.message;
                }
            })
            .catch(error => {
                message.style.color = "red";
                message.textContent = "An error occurred. Please try again.";
                console.error('Error:', error);
            });
        });
    </script>


</body>
</html>